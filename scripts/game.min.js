var timerCreate;var timerFall;function speakerOff(){$('#song')[0].pause();$('#speaker').remove();$('body').append('<a id="speaker" onclick="speakerOn()" href="javascript:void(0);"><img  src="media/speakerOff.png" /></a>')}function speakerOn(){$('#song')[0].play();$('#speaker').remove();$('body').append('<a id="speaker" onclick="speakerOff()" href="javascript:void(0);"><img  src="media/speakerOn.png" /></a>')}function endGame(){$('#container').remove();clearTimeout(timerCreate);$('body').append('<div id="menu"><table><t<tr><td><h1>Raindrop</h1></td></tr><tr><td><button onClick="launchGame()">Retry!</button></td></tr><tr><td><a id="link" href="http://www.thecreator.fr">Visit my website!</a></td></tr></table></div>')}function launchGame(){$('body').append('<div id="container"></div>');$('#menu').remove();var d=new Kinetic.Stage({container:'container',width:$(window).width(),height:$(window).height()});var e=new Kinetic.Layer();var f=new Kinetic.Layer();var g=new Image();g.src='media/character.png';var h=new Image();h.src='media/raindrop.png';var j=new Array();var k;var l=0;var m={idleRight:[{x:0,y:0,width:100,height:125}],idleLeft:[{x:100,y:0,width:100,height:125}],runRight:[{x:0,y:125,width:100,height:125},{x:100,y:130,width:100,height:125},{x:200,y:130,width:100,height:125},{x:300,y:130,width:100,height:125},{x:400,y:130,width:100,height:125},{x:500,y:130,width:100,height:125},{x:600,y:130,width:100,height:125},{x:700,y:130,width:100,height:125}],runLeft:[{x:0,y:250,width:100,height:125},{x:100,y:250,width:100,height:125},{x:200,y:250,width:100,height:125},{x:300,y:250,width:100,height:125},{x:400,y:250,width:100,height:125},{x:500,y:250,width:100,height:125},{x:600,y:250,width:100,height:125},{x:700,y:250,width:100,height:125}]};var n={idle:[{x:0,y:0,width:50,height:50}],crash:[{x:50,y:0,width:50,height:50}]};function rainCreate(){drop=new Kinetic.Sprite({x:Math.random()*$(window).width(),y:-10,image:h,animation:'idle',animations:n,framerate:1,index:0});f.add(drop);drop.start();j.push(drop);l++;$('#score').text('Score: '+l);rainFall()}function rainFall(){for(i=0;i<j.length;i++){if(j[i].getY()<$(window).height()-60){j[i].move(0,5);if(j[i].getY()>$(window).height()-125){if(j[i].getX()+25>=k.getX()&&j[i].getX()+25<=k.getX()+75&&j[i].getAnimation()!='crash'){endGame()}}}else{j[i].setAnimation('crash');if(i>10){j[1].destroy();j.splice(1,1)}}}}h.onload=function(){d.add(f);timerCreate=window.setInterval(rainCreate,50);timerFall=window.setInterval(rainFall,25)}g.onload=function(){k=new Kinetic.Sprite({x:600,y:$(window).height()-130,image:g,animation:'idleRight',animations:m,frameRate:8,index:0});var b='right';e.add(k);d.add(e);k.start();var c=null;document.addEventListener('keydown',function(a){if(a.keyCode==37){b='left';if(c==null){c=setInterval(function(){if(k.getX()>0){if(k.getAnimation()!='runLeft'){keyPressed=true;k.setAnimation('runLeft')}k.setX(k.getX()-10)}},10)}}else if(a.keyCode==39){b='right';if(c==null){c=setInterval(function(){if(k.getX()<$(window).width()-100){if(k.getAnimation()!='runRight'){keyPressed=true;k.setAnimation('runRight')}k.setX(k.getX()+10)}},10)}}});document.addEventListener('keyup',function(a){if(a.keyCode==37||a.keyCode==39){clearTimeout(c);c=null;if(b=='left'){k.setAnimation('idleLeft')}else{k.setAnimation('idleRight')}}})}}